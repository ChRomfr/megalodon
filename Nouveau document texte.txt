DROP TABLE `megalodon`.`contacts_organisme`;
DROP TABLE `megalodon`.`organismes`;

INSERT INTO `modules` (`name`, `actif`) VALUES ('rdv', '1');


CREATE TABLE `rdv` (
  `id` INT NOT NULL AUTO_INCREMENT,
  `date_rdv` DATETIME NOT NULL,
  `user_id` INT NOT NULL,
  `tier_type` VARCHAR(25) NULL,
  `tier_id` INT NULL,
  `source_type` VARCHAR(25) NULL,
  `source_id` INT NULL,
  `description` TEXT NULL,
  `add_by` INT NOT NULL,
  `add_on` DATETIME NOT NULL,
  `statut` INT(2) NULL DEFAULT 0,
  `lieu` TEXT NULL,
  `rapport` TEXT NULL,
  `result` INT(3) NULL,
  PRIMARY KEY (`id`))
ENGINE = MyISAM
COMMENT = 'Contient les rendez vous';

ALTER TABLE `contacts` 
CHANGE COLUMN `adresse1` `adress` TEXT NULL DEFAULT NULL ,
CHANGE COLUMN `code_postal` `zip_code` VARCHAR(20) NULL DEFAULT NULL ,
CHANGE COLUMN `ville` `city` VARCHAR(200) NULL DEFAULT NULL ;

--
ALTER TABLE `user` ADD COLUMN `token` VARCHAR(100) NULL AFTER `index_map_contacts`;
ALTER TABLE `contacts_email` ADD COLUMN `pj` VARCHAR(100) NULL AFTER `result`;
ALTER TABLE `user` ADD COLUMN `sso_link_token` VARCHAR(100) NULL AFTER `token`, ADD COLUMN `sso_link` INT(1) NULL DEFAULT 0 AFTER `sso_link_token`;

CREATE TABLE `logs` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `date_log` datetime NOT NULL,
  `log` text NOT NULL,
  `module` varchar(50) NOT NULL,
  `link_id` varchar(50) NOT NULL,
  `user_id` int(11) DEFAULT NULL,
  `user` varchar(50) DEFAULT NULL,
  PRIMARY KEY (`id`),
  KEY `log_link_id` (`link_id`),
  KEY `log_module` (`module`),
  KEY `log_module_link` (`module`,`link_id`)
) ENGINE=MyISAM DEFAULT CHARSET=utf8;


/*------------------------------------*/
CREATE TABLE `module_type` (
  `id` INT NOT NULL AUTO_INCREMENT,
  `libelle` VARCHAR(100) NOT NULL,
  PRIMARY KEY (`id`))
ENGINE = MyISAM;

CREATE TABLE `modules` (
  `id` INT NOT NULL AUTO_INCREMENT,
  `name` VARCHAR(100) NOT NULL,
  `description` TEXT NULL,
  `actif` INT(1) NOT NULL DEFAULT 0,
  `author` VARCHAR(100) NULL,
  `version` VARCHAR(15) NULL,
  PRIMARY KEY (`id`))
ENGINE = MyISAM
 COMMENT = 'Contient la liste des modules du logiciel';

 CREATE TABLE `sites` (
  `id` INT NOT NULL AUTO_INCREMENT,
  `libelle` VARCHAR(200) NOT NULL,
  `description` TEXT NULL,
  `email` VARCHAR(200) NULL,
  `telephone` VARCHAR(20) NULL,
  `fax` VARCHAR(20) NULL,
  `adresse` TEXT NULL,
  `cp` VARCHAR(15) NULL,
  `ville` VARCHAR(200) NULL,
  `pays` VARCHAR(200) NULL,
  `siege` INT(1) NOT NULL DEFAULT 0,
  PRIMARY KEY (`id`))
ENGINE = MyISAM
COMMENT = 'Informations contenants les differents site de l entreprise';

CREATE TABLE `tiers` (
  `id` INT NOT NULL AUTO_INCREMENT,
  `name` VARCHAR(150) NOT NULL,
  `description` TEXT NULL,
  `adresse` TEXT NULL,
  `cp` VARCHAR(15) NULL,
  `ville` VARCHAR(150) NULL,
  `pays` VARCHAR(150) NULL,
  `email` VARCHAR(200) NULL,
  `tel` VARCHAR(20) NULL,
  `fax` VARCHAR(20) NULL,
  `site` VARCHAR(200) NULL,
  `siret` VARCHAR(50) NULL,
  `tva` VARCHAR(50) NULL,
  `type_id` INT NULL,
  PRIMARY KEY (`id`))
ENGINE = MyISAM;

CREATE TABLE `megalodon`.`tiers_type` (
  `id` INT NOT NULL AUTO_INCREMENT,
  `libelle` VARCHAR(150) NULL,
  PRIMARY KEY (`id`))
ENGINE = MyISAM;

ALTER TABLE `tiers` CHANGE COLUMN `tel` `telephone` VARCHAR(20) NULL DEFAULT NULL , ADD COLUMN `internal_code` VARCHAR(20) NULL AFTER `type_id`;

INSERT INTO `config` (`cle`, `valeur`) VALUES ('ape_multi_choice', '0');
INSERT INTO `config` (`cle`) VALUES ('logo');
INSERT INTO `config` (`cle`) VALUES ('logo_name');


INSERT INTO `module_type` (`libelle`) VALUES ('base');
INSERT INTO `module_type` (`libelle`) VALUES ('addon');

INSERT INTO `modules` (`name`, `description`, `actif`) VALUES ('contacts', '', '1');
INSERT INTO `modules` (`name`, `actif`) VALUES ('mailing', '1');
INSERT INTO `modules` (`name`, `actif`) VALUES ('campaign', '1');